<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: Paru::Filter
  
    &mdash; Paru
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "Paru::Filter";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (F)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../Paru.html" title="Paru (module)">Paru</a></span></span>
     &raquo; 
    <span class="title">Filter</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: Paru::Filter
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Paru::Filter</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/paru/filter.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Filter is used to write your own pandoc filter in Ruby. A Filter is almost
always created and immediately executed via the <code>run</code> method.
The most simple filter you can write in paru is the so-called “identity”:</p>

<p><pre class="code ruby"><span class='comment'>#!/usr/bin/env ruby
</span><span class='comment'># Identity filter
</span><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>paru/filter</span><span class='tstring_end'>&quot;</span></span>

<span class='const'><span class='object_link'><a href="../Paru.html" title="Paru (module)">Paru</a></span></span><span class='op'>::</span><span class='const'>Filter</span><span class='period'>.</span><span class='id identifier rubyid_run'><span class='object_link'><a href="#run-class_method" title="Paru::Filter.run (method)">run</a></span></span> <span class='kw'>do</span>
    <span class='comment'># nothing
</span><span class='kw'>end</span></pre></p>

<p>It runs the filter, but it makes no selection nor performs an action. This
is pretty useless, of course—although it makes for a great way to test the
filter functionality—, but it shows the general setup of a filter well.</p>

<h1 id="label-Writing+a+simple+filter-3A+numbering+figures">Writing a simple filter: numbering figures</h1>

<p>Inside a <span class='object_link'><a href="#run-class_method" title="Paru::Filter.run (method)">Filter.run</a></span> block, you specify <strong>selectors</strong> with
<strong>actions</strong>. For example, to number all figures in a document
and prefix their captions with “Figure”, the following filter would work:</p>

<p><pre class="code ruby"><span class='comment'>#!/usr/bin/env ruby
</span><span class='comment'># Number all figures in a document and prefix the caption with &quot;Figure&quot;.
</span><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>paru/filter</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_figure_counter'>figure_counter</span> <span class='op'>=</span> <span class='int'>0</span><span class='semicolon'>;</span>

<span class='const'><span class='object_link'><a href="../Paru.html" title="Paru (module)">Paru</a></span></span><span class='op'>::</span><span class='const'>Filter</span><span class='period'>.</span><span class='id identifier rubyid_run'><span class='object_link'><a href="#run-class_method" title="Paru::Filter.run (method)">run</a></span></span> <span class='kw'>do</span> 
    <span class='id identifier rubyid_with'>with</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Image</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_image'>image</span><span class='op'>|</span>
        <span class='id identifier rubyid_figure_counter'>figure_counter</span> <span class='op'>+=</span> <span class='int'>1</span>
        <span class='id identifier rubyid_image'>image</span><span class='period'>.</span><span class='id identifier rubyid_inner_markdown'>inner_markdown</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Figure </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_figure_counter'>figure_counter</span><span class='embexpr_end'>}</span><span class='tstring_content'>. </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_image'>image</span><span class='period'>.</span><span class='id identifier rubyid_inner_markdown'>inner_markdown</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre></p>

<p>This filter selects all <span class='object_link'><a href="PandocFilter/Image.html" title="Paru::PandocFilter::Image (class)">PandocFilter::Image</a></span> nodes. For each
<span class='object_link'><a href="PandocFilter/Image.html" title="Paru::PandocFilter::Image (class)">PandocFilter::Image</a></span> node it increments the figure counter
<code>figure_counter</code> and then sets the figure&#39;s caption to
“Figure” followed by the figure count and the original caption.  In other
words, the following input document</p>

<pre class="code ruby"><code class="ruby">![My first image](img/horse.png)

![My second image](img/rabbit.jpeg)</code></pre>

<p>will be transformed into</p>

<pre class="code ruby"><code class="ruby">![Figure 1. My first image](img/horse.png)

![Figure 2. My second image](img/rabbit.jpeg)</code></pre>

<p>The method <span class='object_link'><a href="PandocFilter/Markdown.html#inner_markdown-instance_method" title="Paru::PandocFilter::Markdown#inner_markdown (method)">PandocFilter::Markdown#inner_markdown</a></span> and its counterpart
<span class='object_link'><a href="PandocFilter/Markdown.html#outer_markdown-instance_method" title="Paru::PandocFilter::Markdown#outer_markdown (method)">PandocFilter::Markdown#outer_markdown</a></span> are a great way to manipulate the
contents of a selected <span class='object_link'><a href="PandocFilter/Node.html" title="Paru::PandocFilter::Node (class)">PandocFilter::Node</a></span>. No messing about creating and
filling <span class='object_link'><a href="PandocFilter/Node.html" title="Paru::PandocFilter::Node (class)">PandocFilter::Node</a></span>s, you can just use pandoc&#39;s own markdown
format!</p>

<h1 id="label-Writing+a+more+involved+filters">Writing a more involved filters</h1>

<h2 id="label-Using+the+-22follows-22+selector-3A+Numbering+figures+and+chapters">Using the “follows” selector: Numbering figures and chapters</h2>

<p>The previous example can be extended to also number chapters and to start
numbering figures anew per chapter. As you would expect, we need two
counters, one for the figures and one for the chapters:</p>

<p><pre class="code ruby"><span class='comment'>#!/usr/bin/env ruby
</span><span class='comment'># Number figures per chapter; number chapters as well
</span><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>paru/filter</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_current_chapter'>current_chapter</span> <span class='op'>=</span> <span class='int'>0</span>
<span class='id identifier rubyid_current_figure'>current_figure</span> <span class='op'>=</span> <span class='int'>0</span><span class='semicolon'>;</span>

<span class='const'><span class='object_link'><a href="../Paru.html" title="Paru (module)">Paru</a></span></span><span class='op'>::</span><span class='const'>Filter</span><span class='period'>.</span><span class='id identifier rubyid_run'><span class='object_link'><a href="#run-class_method" title="Paru::Filter.run (method)">run</a></span></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_with'>with</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Header</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_header'>header</span><span class='op'>|</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_header'>header</span><span class='period'>.</span><span class='id identifier rubyid_level'>level</span> <span class='op'>==</span> <span class='int'>1</span> 
            <span class='id identifier rubyid_current_chapter'>current_chapter</span> <span class='op'>+=</span> <span class='int'>1</span>
            <span class='id identifier rubyid_current_figure'>current_figure</span> <span class='op'>=</span> <span class='int'>0</span>

            <span class='id identifier rubyid_header'>header</span><span class='period'>.</span><span class='id identifier rubyid_inner_markdown'>inner_markdown</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Chapter </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_current_chapter'>current_chapter</span><span class='embexpr_end'>}</span><span class='tstring_content'>. </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_header'>header</span><span class='period'>.</span><span class='id identifier rubyid_inner_markdown'>inner_markdown</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_with'>with</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Header + Image</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_image'>image</span><span class='op'>|</span>
        <span class='id identifier rubyid_current_figure'>current_figure</span> <span class='op'>+=</span> <span class='int'>1</span>
        <span class='id identifier rubyid_image'>image</span><span class='period'>.</span><span class='id identifier rubyid_inner_markdown'>inner_markdown</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Figure </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_current_chapter'>current_chapter</span><span class='embexpr_end'>}</span><span class='tstring_content'>.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_current_figure'>current_figure</span><span class='embexpr_end'>}</span><span class='tstring_content'>. </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_image'>image</span><span class='period'>.</span><span class='id identifier rubyid_inner_markdown'>inner_markdown</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre></p>

<p>What is new in this filter, however, is the selector “Header + Image” which
selects all <span class='object_link'><a href="PandocFilter/Image.html" title="Paru::PandocFilter::Image (class)">PandocFilter::Image</a></span> nodes that <strong>follow</strong> a
<span class='object_link'><a href="PandocFilter/Header.html" title="Paru::PandocFilter::Header (class)">PandocFilter::Header</a></span> node. Documents in pandoc have a <em>flat</em>
structure where chapters do not exists as separate concepts. Instead, a
chapter is implied by a header of a certain level and everything that
follows until the next header of that level.</p>

<h2 id="label-Using+the+-22child+of-22+selector-3A+Annotate+custom+blocks">Using the “child of” selector: Annotate custom blocks</h2>

<p>Hierarchical structures do exist in a pandoc document, however. For
example, the contents of a paragraph (<span class='object_link'><a href="PandocFilter/Para.html" title="Paru::PandocFilter::Para (class)">PandocFilter::Para</a></span>), which itself
is a <span class='object_link'><a href="PandocFilter/Block.html" title="Paru::PandocFilter::Block (class)">PandocFilter::Block</a></span> level node, are <span class='object_link'><a href="PandocFilter/Inline.html" title="Paru::PandocFilter::Inline (class)">PandocFilter::Inline</a></span> level
nodes. Another example are custom block or <span class='object_link'><a href="PandocFilter/Div.html" title="Paru::PandocFilter::Div (class)">PandocFilter::Div</a></span> nodes.  You
select a child node by using the <tt>&gt;</tt> selector as in the example below:</p>

<p><pre class="code ruby"><span class='comment'>#!/usr/bin/env ruby
</span><span class='comment'># Annotate custom blocks: example blocks and important blocks
</span><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>paru/filter</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_example_count'>example_count</span> <span class='op'>=</span> <span class='int'>0</span>

<span class='const'><span class='object_link'><a href="../Paru.html" title="Paru (module)">Paru</a></span></span><span class='op'>::</span><span class='const'>Filter</span><span class='period'>.</span><span class='id identifier rubyid_run'><span class='object_link'><a href="#run-class_method" title="Paru::Filter.run (method)">run</a></span></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_with'>with</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Div.example &gt; Header</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_header'>header</span><span class='op'>|</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_header'>header</span><span class='period'>.</span><span class='id identifier rubyid_level'>level</span> <span class='op'>==</span> <span class='int'>3</span> 
            <span class='id identifier rubyid_example_count'>example_count</span> <span class='op'>+=</span> <span class='int'>1</span>
            <span class='id identifier rubyid_header'>header</span><span class='period'>.</span><span class='id identifier rubyid_inner_markdown'>inner_markdown</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Example </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_example_count'>example_count</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_header'>header</span><span class='period'>.</span><span class='id identifier rubyid_inner_markdown'>inner_markdown</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_with'>with</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Div.important</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_d'>d</span><span class='op'>|</span>
        <span class='id identifier rubyid_d'>d</span><span class='period'>.</span><span class='id identifier rubyid_inner_markdown'>inner_markdown</span> <span class='op'>=</span> <span class='id identifier rubyid_d'>d</span><span class='period'>.</span><span class='id identifier rubyid_inner_markdown'>inner_markdown</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n\n*(important)*</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

<span class='kw'>end</span></pre></p>

<p>Here all <span class='object_link'><a href="PandocFilter/Header.html" title="Paru::PandocFilter::Header (class)">PandocFilter::Header</a></span> nodes that are inside a <span class='object_link'><a href="PandocFilter/Div.html" title="Paru::PandocFilter::Div (class)">PandocFilter::Div</a></span>
node are selected. Furthermore, if these headers are of level 3, they are
prefixed by the string “Example” followed by a count.</p>

<p>In this example, “important” <span class='object_link'><a href="PandocFilter/Div.html" title="Paru::PandocFilter::Div (class)">PandocFilter::Div</a></span> nodes are annotated by
putting the string <strong>important</strong> before the contents of the
node.</p>

<h2 id="label-Using+a+distance+in+a+selector-3A+Capitalize+the+first+N+characters+of">Using a distance in a selector: Capitalize the first N characters of</h2>

<p>a paragraph</p>

<p>Given the flat structure of a pandoc document, the “follows” selector has
quite a reach. For example, “Header + Para” selects all paragraphs that
follow a header. In most well-structured documents, this would select
basically all paragraphs.</p>

<p>But what if you need to be more specific? For example, if you would like to
capitalize the first sentence of each first paragraph of a chapter, you
need a way to specify a sequence number of sorts. To that end, paru filter
selectors take an optional <strong>distance</strong> parameter. A filter
for this example could look like:</p>

<p><pre class="code ruby"><span class='comment'>#!/usr/bin/env ruby
</span><span class='comment'># Capitalize the first N characters of a paragraph
</span><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>paru/filter</span><span class='tstring_end'>&quot;</span></span>

<span class='const'>END_CAPITAL</span> <span class='op'>=</span> <span class='int'>10</span>
<span class='const'><span class='object_link'><a href="../Paru.html" title="Paru (module)">Paru</a></span></span><span class='op'>::</span><span class='const'>Filter</span><span class='period'>.</span><span class='id identifier rubyid_run'><span class='object_link'><a href="#run-class_method" title="Paru::Filter.run (method)">run</a></span></span> <span class='kw'>do</span> 
    <span class='id identifier rubyid_with'>with</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Header +1 Para</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='op'>|</span>
        <span class='id identifier rubyid_text'>text</span> <span class='op'>=</span> <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_inner_markdown'>inner_markdown</span>
        <span class='id identifier rubyid_first_line'>first_line</span> <span class='op'>=</span> <span class='id identifier rubyid_text'>text</span><span class='period'>.</span><span class='id identifier rubyid_slice'>slice</span><span class='lparen'>(</span><span class='int'>0</span><span class='comma'>,</span> <span class='const'>END_CAPITAL</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_upcase'>upcase</span>
        <span class='id identifier rubyid_rest'>rest</span> <span class='op'>=</span> <span class='id identifier rubyid_text'>text</span><span class='period'>.</span><span class='id identifier rubyid_slice'>slice</span><span class='lparen'>(</span><span class='const'>END_CAPITAL</span><span class='comma'>,</span> <span class='id identifier rubyid_text'>text</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_inner_markdown'>inner_markdown</span> <span class='op'>=</span> <span class='id identifier rubyid_first_line'>first_line</span> <span class='op'>+</span> <span class='id identifier rubyid_rest'>rest</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre></p>

<p>The distance is denoted after a selector by an integer. In this case
“Header +1 Para” selects all <span class='object_link'><a href="PandocFilter/Para.html" title="Paru::PandocFilter::Para (class)">PandocFilter::Para</a></span> nodes that directly
follow an <span class='object_link'><a href="PandocFilter/Header.html" title="Paru::PandocFilter::Header (class)">PandocFilter::Header</a></span> node. You can use a distance with any
selector.</p>

<h2 id="label-Manipulating+nodes-3A+Removing+horizontal+lines">Manipulating nodes: Removing horizontal lines</h2>

<p>Although the <span class='object_link'><a href="PandocFilter/Markdown.html#inner_markdown-instance_method" title="Paru::PandocFilter::Markdown#inner_markdown (method)">PandocFilter::Markdown#inner_markdown</a></span> and
<span class='object_link'><a href="PandocFilter/Markdown.html#outer_markdown-instance_method" title="Paru::PandocFilter::Markdown#outer_markdown (method)">PandocFilter::Markdown#outer_markdown</a></span> work in most situations, sometimes
direct manipulation of the pandoc document AST is useful. These
<span class='object_link'><a href="PandocFilter/ASTManipulation.html" title="Paru::PandocFilter::ASTManipulation (module)">PandocFilter::ASTManipulation</a></span> methods are mixed in <span class='object_link'><a href="PandocFilter/Node.html" title="Paru::PandocFilter::Node (class)">PandocFilter::Node</a></span>
and can be used on any node in your filter. For example, to delete all
<span class='object_link'><a href="PandocFilter/HorizontalRule.html" title="Paru::PandocFilter::HorizontalRule (class)">PandocFilter::HorizontalRule</a></span> nodes, can use a filter like:</p>

<p><pre class="code ruby"><span class='comment'>#!/usr/bin/env ruby
</span><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>paru/filter</span><span class='tstring_end'>&quot;</span></span>

<span class='const'><span class='object_link'><a href="../Paru.html" title="Paru (module)">Paru</a></span></span><span class='op'>::</span><span class='const'>Filter</span><span class='period'>.</span><span class='id identifier rubyid_run'><span class='object_link'><a href="#run-class_method" title="Paru::Filter.run (method)">run</a></span></span> <span class='kw'>do</span> 
    <span class='id identifier rubyid_with'>with</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>HorizontalRule</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_rule'>rule</span><span class='op'>|</span>

        <span class='kw'>if</span> <span class='id identifier rubyid_rule'>rule</span><span class='period'>.</span><span class='id identifier rubyid_has_parent?'>has_parent?</span> <span class='kw'>then</span>
            <span class='id identifier rubyid_rule'>rule</span><span class='period'>.</span><span class='id identifier rubyid_parent'>parent</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span> <span class='id identifier rubyid_rule'>rule</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre></p>

<p>Note that you could have arrived at the same effect by using:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_rule'>rule</span><span class='period'>.</span><span class='id identifier rubyid_outer_markdown'>outer_markdown</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
</code></pre>

<h2 id="label-Manipulating+metadata-3A+">Manipulating metadata: </h2>

<p>One of the interesting features of the pandoc markdown format is the
ability to add metadata to a document via a YAML block or command line
options. For example, if you use a template that uses the metadata property
<tt>$date$</tt> to write a date on a title page, it is quite useful to
automatically add the date of <em>today</em> to the metadata. You can do so
with a filter like:</p>

<p><pre class="code ruby"><span class='comment'>#!/usr/bin/env ruby
</span><span class='comment'>## Add today&#39;s date to the metadata
</span><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>paru/filter</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>date</span><span class='tstring_end'>&quot;</span></span>

<span class='const'><span class='object_link'><a href="../Paru.html" title="Paru (module)">Paru</a></span></span><span class='op'>::</span><span class='const'>Filter</span><span class='period'>.</span><span class='id identifier rubyid_run'><span class='object_link'><a href="#run-class_method" title="Paru::Filter.run (method)">run</a></span></span> <span class='kw'>do</span> 
    <span class='id identifier rubyid_metadata'>metadata</span><span class='period'>.</span><span class='id identifier rubyid_yaml'>yaml</span> <span class='heredoc_beg'>&lt;&lt;~YAML</span>
<span class='tstring_content'>        ---
</span><span class='tstring_content'>        date: </span><span class='embexpr_beg'>#{</span><span class='const'>Date</span><span class='period'>.</span><span class='id identifier rubyid_today'>today</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_content'>
</span><span class='tstring_content'>        ...
</span><span class='heredoc_end'>    YAML
</span><span class='kw'>end</span></pre></p>


  </div>
</div>
<div class="tags">
  

</div>






  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#run-class_method" title="run (class method)">.<strong>run</strong>(&amp;block)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Run the filter specified by block.</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#current_node-instance_method" title="#current_node (instance method)">#<strong>current_node</strong>  &#x21d2; Node </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p><code>current_node</code> points to the node that is <strong>now</strong>
being processed while running this filter.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#document-instance_method" title="#document (instance method)">#<strong>document</strong>  &#x21d2; Document </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The Document node from JSON formatted pandoc document structure on STDIN
that is being filtered.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#filter-instance_method" title="#filter (instance method)">#<strong>filter</strong>(&amp;block)  &#x21d2; JSON </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Create a filter using <code>block</code>.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>(input = $stdin, output = $stdout)  &#x21d2; Filter </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Create a new Filter instance.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#metadata-instance_method" title="#metadata (instance method)">#<strong>metadata</strong>  &#x21d2; Meta </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>While running a filter you can access the document&#39;s metadata through
the <code>metadata</code> method.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#with-instance_method" title="#with (instance method)">#<strong>with</strong>(selector) {|Node| ... } &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Specify what nodes to filter with a <code>selector</code>.</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>(input = $stdin, output = $stdout)  &#x21d2; <tt><span class='object_link'><a href="" title="Paru::Filter (class)">Filter</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Create a new Filter instance. For convenience, <span class='object_link'><a href="#run-class_method" title="Paru::Filter.run (method)">run</a></span> creates a new <span class='object_link'><a href="" title="Paru::Filter (class)">Paru::Filter</a></span>
and runs it immediately. Use this constructor if you want to run a filter
on different input and output streams that STDIN and STDOUT respectively.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>input</span>
      
      
        <span class='type'>(<tt>IO = $stdin</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>$stdin</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>the input stream to read, defaults to STDIN</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>output</span>
      
      
        <span class='type'>(<tt>IO = $stdout</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>$stdout</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>the output stream to write, defaults to  STDOUT</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


210
211
212
213</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/paru/filter.rb', line 210</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_input'>input</span> <span class='op'>=</span> <span class='gvar'>$stdin</span><span class='comma'>,</span> <span class='id identifier rubyid_output'>output</span> <span class='op'>=</span> <span class='gvar'>$stdout</span><span class='rparen'>)</span>
    <span class='ivar'>@input</span> <span class='op'>=</span> <span class='id identifier rubyid_input'>input</span>
    <span class='ivar'>@output</span> <span class='op'>=</span> <span class='id identifier rubyid_output'>output</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="run-class_method">
  
    .<strong>run</strong>(&amp;block)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Run the filter specified by block. This is a convenience method that
creates a new <span class='object_link'><a href="" title="Paru::Filter (class)">Paru::Filter</a></span> using input stream STDIN and output stream STDOUT
and immediately runs <span class='object_link'><a href="#filter-instance_method" title="Paru::Filter#filter (method)">#filter</a></span> with the block supplied.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Add &#39;Figure&#39; to each image&#39;s caption</p>
</div></p>
      
      <pre class="example code"><code><span class='const'><span class='object_link'><a href="../Paru.html" title="Paru (module)">Paru</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Paru::Filter (class)">Filter</a></span></span><span class='period'>.</span><span class='id identifier rubyid_run'>run</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_with'>with</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Image</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_image'>image</span><span class='op'>|</span>
        <span class='id identifier rubyid_image'>image</span><span class='period'>.</span><span class='id identifier rubyid_inner_markdown'>inner_markdown</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Figure. </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_image'>image</span><span class='period'>.</span><span class='id identifier rubyid_inner_markdown'>inner_markdown</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>block</span>
      
      
        <span class='type'>(<tt>Proc</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the filter specification</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


227
228
229</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/paru/filter.rb', line 227</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_run'>run</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='const'><span class='object_link'><a href="" title="Paru::Filter (class)">Filter</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#initialize-instance_method" title="Paru::Filter#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='gvar'>$stdin</span><span class='comma'>,</span> <span class='gvar'>$stdout</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_filter'><span class='object_link'><a href="#filter-instance_method" title="Paru::Filter#filter (method)">filter</a></span></span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="current_node-instance_method">
  
    #<strong>current_node</strong>  &#x21d2; <tt>Node</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p><code>current_node</code> points to the node that is <strong>now</strong>
being processed while running this filter.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Node</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the node that is currently being processed</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


278
279
280</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/paru/filter.rb', line 278</span>

<span class='kw'>def</span> <span class='id identifier rubyid_current_node'>current_node</span><span class='lparen'>(</span><span class='rparen'>)</span>
    <span class='ivar'>@filtered_nodes</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="document-instance_method">
  
    #<strong>document</strong>  &#x21d2; <tt>Document</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The Document node from JSON formatted pandoc document structure on STDIN
that is being filtered</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Document</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>create a new Document node from a pandoc AST from JSON from STDIN</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


236
237
238</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/paru/filter.rb', line 236</span>

<span class='kw'>def</span> <span class='id identifier rubyid_document'>document</span><span class='lparen'>(</span><span class='rparen'>)</span>
    <span class='const'><span class='object_link'><a href="PandocFilter.html" title="Paru::PandocFilter (module)">PandocFilter</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="PandocFilter/Document.html" title="Paru::PandocFilter::Document (class)">Document</a></span></span><span class='period'>.</span><span class='id identifier rubyid_from_JSON'><span class='object_link'><a href="PandocFilter/Document.html#from_JSON-class_method" title="Paru::PandocFilter::Document.from_JSON (method)">from_JSON</a></span></span> <span class='ivar'>@input</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="filter-instance_method">
  
    #<strong>filter</strong>(&amp;block)  &#x21d2; <tt>JSON</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Create a filter using <code>block</code>. In the block you specify
selectors and actions to be performed on selected nodes. In the example
below, the selector is “Image”, which selects all image nodes. The action
is to prepend the contents of the image&#39;s caption by the string
“Figure. ”.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Add &#39;Figure&#39; to each image&#39;s caption</p>
</div></p>
      
      <pre class="example code"><code>input = IOString.new(File.read(&quot;my_report.md&quot;)
output = IOString.new

Paru::Filter.new(input, output).filter do
    with &quot;Image&quot; do |image|
        image.inner_markdown = &quot;Figure. #{image.inner_markdown}&quot;
    end
end

# do something with output.string</code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>block</span>
      
      
        <span class='type'>(<tt>Proc</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the filter specification</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>JSON</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>a JSON string with the filtered pandoc AST</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


261
262
263
264
265
266
267
268
269
270
271
272</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/paru/filter.rb', line 261</span>

<span class='kw'>def</span> <span class='id identifier rubyid_filter'>filter</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='ivar'>@selectors</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='ivar'>@filtered_nodes</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='ivar'>@doc</span> <span class='op'>=</span> <span class='id identifier rubyid_document'>document</span>

    <span class='ivar'>@doc</span><span class='period'>.</span><span class='id identifier rubyid_each_depth_first'>each_depth_first</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_node'>node</span><span class='op'>|</span>
        <span class='ivar'>@filtered_nodes</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span> <span class='id identifier rubyid_node'>node</span>
        <span class='id identifier rubyid_instance_eval'>instance_eval</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='ivar'>@output</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span> <span class='ivar'>@doc</span><span class='period'>.</span><span class='id identifier rubyid_to_JSON'>to_JSON</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="metadata-instance_method">
  
    #<strong>metadata</strong>  &#x21d2; <tt>Meta</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>While running a filter you can access the document&#39;s metadata through
the <code>metadata</code> method.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Meta</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the filtered document&#39;s metadata</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


296
297
298</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/paru/filter.rb', line 296</span>

<span class='kw'>def</span> <span class='id identifier rubyid_metadata'>metadata</span><span class='lparen'>(</span><span class='rparen'>)</span>
    <span class='ivar'>@doc</span><span class='period'>.</span><span class='id identifier rubyid_meta'>meta</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="with-instance_method">
  
    #<strong>with</strong>(selector) {|Node| ... } &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Specify what nodes to filter with a <code>selector</code>. If the
<code>current_node</code> matches that selector, it is passed to the block
to this <code>with</code> method.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>selector</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>a selector string</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Yields:</p>
<ul class="yield">
  
    <li>
      
      
        <span class='type'>(<tt>Node</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the current node if it matches the selector</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


287
288
289
290</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/paru/filter.rb', line 287</span>

<span class='kw'>def</span> <span class='id identifier rubyid_with'>with</span><span class='lparen'>(</span><span class='id identifier rubyid_selector'>selector</span><span class='rparen'>)</span>
    <span class='ivar'>@selectors</span><span class='lbracket'>[</span><span class='id identifier rubyid_selector'>selector</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Selector.html" title="Paru::Selector (class)">Selector</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Selector.html#initialize-instance_method" title="Paru::Selector#initialize (method)">new</a></span></span> <span class='id identifier rubyid_selector'>selector</span> <span class='kw'>unless</span> <span class='ivar'>@selectors</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span> <span class='id identifier rubyid_selector'>selector</span>
    <span class='kw'>yield</span> <span class='id identifier rubyid_current_node'>current_node</span> <span class='kw'>if</span> <span class='ivar'>@selectors</span><span class='lbracket'>[</span><span class='id identifier rubyid_selector'>selector</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_matches?'>matches?</span> <span class='id identifier rubyid_current_node'>current_node</span><span class='comma'>,</span> <span class='ivar'>@filtered_nodes</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Tue May 30 21:00:34 2017 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.9 (ruby-2.3.3).
</div>

    </div>
  </body>
</html>